<div class="bg-gray-50/50 py-16 animate-fade-in-up">
  <div class="max-w-7xl mx-auto px-4">
    <div class="max-w-3xl mx-auto bg-white p-8 md:p-12 rounded-xl shadow-lg">

      @if (!currentUser()) {
        <div class="text-center py-12">
          <svg class="w-16 h-16 mx-auto text-amber-500" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z" /></svg>
          <h2 class="text-3xl font-black text-[#2f3c7e] mt-6">مطلوب تسجيل الدخول</h2>
          <p class="mt-2 text-lg text-gray-600">يجب عليك تسجيل الدخول أو إنشاء حساب جديد لتتمكن من تقديم طلب الانضمام كمحاضر.</p>
        </div>
      } @else {
        @switch (page()) {
          @case ('form') {
            <div class="text-center mb-8">
              <h2 class="text-4xl font-black text-[#2f3c7e]">انضم إلى فريق المحاضرين</h2>
              <p class="mt-2 text-lg text-gray-600">شارك معرفتك وخبرتك مع آلاف المتعلمين العرب. الخطوة التالية هي مقابلة فيديو قصيرة.</p>
            </div>
            <form (submit)="startApplication($event)" class="space-y-6">
              <div>
                <label for="expertise_field" class="block text-sm font-bold text-gray-700 mb-2">مجال الخبرة الأساسي *</label>
                <select name="expertise_field" id="expertise_field" required class="w-full px-4 py-3 bg-gray-100 rounded-lg border-transparent focus:border-teal-500 focus:ring focus:ring-teal-500 focus:ring-opacity-50 transition duration-200 text-gray-800 appearance-none">
                   <option value="الرسم والتصميم">الرسم والتصميم</option>
                   <option value="التسويق">التسويق</option>
                   <option value="تكنولوجيا المعلومات">تكنولوجيا المعلومات</option>
                   <option value="الأعمال">الأعمال</option>
                   <option value="التصوير وصناعة الأفلام">التصوير وصناعة الأفلام</option>
                   <option value="اللغات">اللغات</option>
                   <option value="الموارد البشرية">الموارد البشرية</option>
                </select>
              </div>
              <div>
                <label for="linkedin" class="block text-sm font-bold text-gray-700 mb-2">رابط ملفك على لينكدإن (اختياري)</label>
                <input type="url" name="linkedin" id="linkedin" class="w-full px-4 py-3 bg-gray-100 rounded-lg border-transparent focus:border-teal-500 focus:ring focus:ring-teal-500 focus:ring-opacity-50 transition duration-200 text-gray-800">
              </div>
              <div>
                <label for="bio" class="block text-sm font-bold text-gray-700 mb-2">نبذة عنك وعن خبراتك *</label>
                <textarea name="bio" id="bio" rows="4" required class="w-full px-4 py-3 bg-gray-100 rounded-lg border-transparent focus:border-teal-500 focus:ring focus:ring-teal-500 focus:ring-opacity-50 transition duration-200 text-gray-800"></textarea>
              </div>
               <div>
                <label for="cvFile" class="block text-sm font-bold text-gray-700 mb-2">ارفع سيرتك الذاتية (CV) *</label>
                <input (change)="handleCvFileChange($event)" type="file" name="cvFile" id="cvFile" required accept=".pdf,.doc,.docx" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-teal-50 file:text-teal-700 hover:file:bg-teal-100 cursor-pointer">
              </div>
              <div>
                <button type="submit" [disabled]="!selectedCvFile()" class="w-full bg-[#00c896] text-white font-bold py-4 px-10 rounded-lg text-lg hover:scale-105 transform transition-all duration-300 shadow-lg hover:shadow-xl hover:shadow-[#00c896]/30 disabled:bg-gray-400 disabled:cursor-not-allowed disabled:scale-100 flex items-center justify-center">
                  <span>بدء المقابلة المسجلة</span>
                </button>
              </div>
            </form>
          }
          @case ('interview') {
            <div class="text-center">
              <h2 class="text-3xl font-black text-[#2f3c7e]">مقابلة الفيديو المسجلة</h2>
              <p class="mt-2 text-lg text-gray-600">أجب عن الأسئلة التالية لنتعرف عليك بشكل أفضل.</p>
            </div>
            <div class="mt-8">
              <div class="bg-gray-100 rounded-lg p-4 mb-4 text-center">
                <p class="font-semibold text-gray-500">السؤال {{ currentQuestionIndex() + 1 }} من {{ interviewQuestions().length }}</p>
                <p class="text-xl font-bold text-gray-800 mt-1">{{ currentQuestion().text }}</p>
              </div>
              
              <div class="bg-black rounded-lg aspect-video w-full overflow-hidden relative">
                <video #videoPlayer autoplay playsinline muted class="w-full h-full object-cover"></video>
                @if (!isCameraReady()) {
                  <div class="absolute inset-0 bg-black/70 flex flex-col items-center justify-center text-white">
                    <svg class="animate-spin h-8 w-8 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                    <p class="mt-4">جاري تجهيز الكاميرا...</p>
                    @if (errorMessage()) {
                      <p class="mt-2 text-red-400 text-sm">{{ errorMessage() }}</p>
                    }
                  </div>
                }
                @if (currentAnswer()?.recordingState === 'recording') {
                   <div class="absolute top-4 right-4 flex items-center bg-red-600 text-white px-3 py-1 rounded-full text-sm font-bold animate-pulse">
                      <div class="w-3 h-3 bg-white rounded-full mr-2"></div>
                      REC
                   </div>
                }
              </div>
              
              <div class="mt-6 flex flex-col sm:flex-row items-center justify-center gap-4">
                 @if(currentAnswer()?.recordingState === 'idle') {
                    <button (click)="startRecording()" [disabled]="!isCameraReady()" class="w-full sm:w-auto bg-red-600 text-white font-bold py-3 px-8 rounded-lg text-lg hover:bg-red-700 transform transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center gap-2">
                       <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 0 0 6-6V6.75a6 6 0 0 0-12 0v6a6 6 0 0 0 6 6Z" /></svg>
                       ابدأ التسجيل
                    </button>
                 }
                 @if(currentAnswer()?.recordingState === 'recording') {
                    <button (click)="stopRecording()" class="w-full sm:w-auto bg-gray-700 text-white font-bold py-3 px-8 rounded-lg text-lg hover:bg-gray-800 transform transition-colors flex items-center justify-center gap-2">
                      <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M6 6h12v12H6z"/></svg>
                      أوقف التسجيل
                    </button>
                 }
                 @if(currentAnswer()?.recordingState === 'finished') {
                    <button (click)="retakeVideo()" class="w-full sm:w-auto bg-gray-200 text-gray-800 font-bold py-3 px-8 rounded-lg text-lg hover:bg-gray-300 transform transition-colors flex items-center justify-center gap-2">
                        <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125" /></svg>
                        إعادة التسجيل
                    </button>
                    @if (!isLastQuestion()) {
                       <button (click)="nextQuestion()" class="w-full sm:w-auto bg-[#00c896] text-white font-bold py-3 px-8 rounded-lg text-lg hover:scale-105 transform transition-all shadow-lg flex items-center justify-center gap-2">
                          السؤال التالي
                          <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" /></svg>
                       </button>
                    }
                 }
              </div>

               @if (isLastQuestion() && canSubmit()) {
                  <div class="mt-10 pt-6 border-t">
                    <button (click)="submitFinalApplication()" class="w-full bg-[#2f3c7e] text-white font-bold py-4 px-10 rounded-lg text-lg hover:bg-opacity-90 transform transition-colors duration-300 shadow-lg flex items-center justify-center">
                      إرسال الطلب النهائي
                    </button>
                  </div>
               }
            </div>
          }
          @case('submitting') {
             <div class="text-center py-12">
               <svg class="animate-spin h-16 w-16 text-[#00c896] mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
               <h2 class="text-3xl font-black text-[#2f3c7e] mt-6">جاري إرسال طلبك...</h2>
               <p class="mt-2 text-lg text-gray-600">يتم الآن رفع ملفاتك. قد يستغرق هذا بعض الوقت.</p>
             </div>
          }
          @case('success') {
             <div class="text-center py-12">
               <svg class="w-24 h-24 mx-auto text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
               <h2 class="text-3xl font-black text-[#2f3c7e] mt-6">تم استلام طلبك بنجاح!</h2>
               <p class="mt-2 text-lg text-gray-600">شكراً لاهتمامك بالانضمام إلى منصة "ممكن". سنقوم بمراجعة طلبك وسنتواصل معك في أقرب وقت ممكن.</p>
             </div>
          }
           @case('alreadyApplied') {
             <div class="text-center py-12">
                <svg class="w-24 h-24 mx-auto text-sky-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
               <h2 class="text-3xl font-black text-[#2f3c7e] mt-6">لقد قدمت طلباً بالفعل</h2>
               <p class="mt-2 text-lg text-gray-600">طلبك قيد المراجعة حالياً. سنقوم بإعلامك بالنتائج قريباً.</p>
             </div>
          }
          @case('error') {
            <div class="text-center py-12">
              <svg class="w-24 h-24 mx-auto text-red-500" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" /></svg>
              <h2 class="text-3xl font-black text-[#2f3c7e] mt-6">حدث خطأ</h2>
              <p class="mt-2 text-lg text-red-600">{{ errorMessage() }}</p>
              <button (click)="page.set('form')" class="mt-8 bg-[#2f3c7e] text-white font-bold py-3 px-8 rounded-lg hover:bg-opacity-90 transition-colors">
                العودة والمحاولة مرة أخرى
              </button>
            </div>
          }
        }
      }
    </div>
  </div>
</div>